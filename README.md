## README — Парсер вакансий hh.ru (только Россия) → CSV

Парсер обращается к публичному API hh.ru, собирает вакансии по одному или нескольким поисковым запросам и сохраняет результат в CSV с подробной информацией по каждой вакансии: ИНН компании, зарплата, навыки, контакты (если доступны), описание без HTML и т.д.

Поддерживает режим **Russia-only**, **несколько запросов из файла**, **verbose-прогресс** и **защиту от перегруза API** (таймауты, ретраи, backoff, обработка 429).

---

### Установка

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

---

### Быстрый старт

**Один запрос из командной строки (ключевые слова объединяются в одну строку поиска):**

```bash
python hh_parser.py "финансовый директор удаленно" -o vacancies.csv
```

**Verbose-прогресс:**

```bash
python hh_parser.py -v "финдир удаленно" -o vacancies.csv
```

---

## Использование

### 1) Поиск по одному запросу

```bash
python hh_parser.py <ключевые_слова> [опции]
```

Ключевые слова передаются через пробел и объединяются в один поисковый запрос.

Пример:

```bash
python hh_parser.py финдир удаленно --page-count 2 --per-page 50 -o out.csv
```

---

### 2) Поиск по нескольким запросам из файла

Можно указать файл, где запросы идут **по строкам**, а также можно перечислять несколько запросов через **запятую**.

**queries.txt**

```
финансовый директор, финдир удаленно, управленческий учет
внедрение управленческого учета
cfo remote
```

Запуск:

```bash
python hh_parser.py -v --queries-file queries.txt --page-count 2 --per-page 50 -o out.csv
```

---

## Опции

### Основные

* `-o`, `--output` — путь к CSV-файлу (по умолчанию `vacancies.csv`)
* `-f`, `--queries-file` — путь к файлу с несколькими запросами (строки/запятые)
* `-v`, `--verbose` — вывод прогресса выполнения в терминал

### Фильтры API hh.ru

* `--specialization` — код специализации (см. API hh.ru `/specializations`)
* `--industry` — идентификатор индустрии (см. API hh.ru `/industries`)
* `--employment` — тип занятости (`full`, `part`, `project`, `volunteer`, `probation`)
* `--schedule` — тип графика (`fullDay`, `shift`, `flexible`, `remote`, `flyInFlyOut`)
* `--experience` — опыт (`noExperience`, `between1And3`, `between3And6`, `moreThan6`)

### Пагинация

* `--page-count` — максимум страниц результатов на **каждый** запрос (по умолчанию `2`)
* `--per-page` — вакансий на странице (`1..100`, по умолчанию `50`)

### Защита от перегруза API / бана

* `--min-interval` — минимальный интервал между **любыми** запросами к API (по умолчанию `0.35` сек)
* `--search-throttle` — доп. пауза после каждого поискового запроса (по умолчанию `0.2` сек)
* `--detail-throttle` — доп. пауза после каждого запроса деталей вакансии (по умолчанию `0.25` сек)
* `--max-details` — ограничение количества детальных карточек **на один запрос** (0 = без лимита)

> Скрипт автоматически обрабатывает `429 Too Many Requests` и уважает `Retry-After`, использует ретраи и backoff, а также имеет “предохранители” по скорости запросов.

---

## Особенности

### Только Россия

Парсер принудительно работает в режиме **Russia-only** (`area=113`) и **не собирает вакансии из других стран**.

### ИНН и контакты

* ИНН берётся из `employer.inn` в деталях вакансии (если доступно в API).
* Контактное лицо и контакты берутся из `contacts` (если работодатель их открыл).
* Поле `owner` заполняется максимально корректно: сначала пытается взять контактное лицо, затем менеджера (если есть), иначе — название работодателя как fallback.

---

## Выходные данные (CSV)

CSV содержит следующие колонки:

* `query` — поисковый запрос, по которому найдена вакансия
* `title` — название вакансии
* `company` — компания
* `inn` — ИНН компании (если доступен)
* `salary` — зарплата (или `—`)
* `skills` — ключевые навыки
* `link` — ссылка на вакансию
* `contact_person` — контактное лицо (если доступно)
* `contacts` — телефоны/почта (если доступны)
* `owner` — ответственный/владелец (fallback-логика)
* `description` — описание вакансии без HTML

---

## Как это работает

1. Делает запрос к `/vacancies` с фильтрами и `area=113` (Россия).
2. Получает список вакансий (`items`).
3. Для каждой вакансии запрашивает детальную карточку `/vacancies/{id}`.
4. Достаёт ИНН, навыки, описание, контакты и формирует строку CSV.
5. Продолжает работу даже при ошибках отдельных страниц/вакансий (в verbose-режиме видно, что пропущено и почему).

---

## Примеры

**Собрать 2 страницы по каждому запросу из файла:**

```bash
python hh_parser.py -v --queries-file queries.txt --page-count 2 --per-page 50 -o vacancies.csv
```

**Более “бережный” режим (меньше риск словить ограничение):**

```bash
python hh_parser.py -v --queries-file queries.txt \
  --min-interval 0.7 --search-throttle 0.5 --detail-throttle 0.7 \
  --page-count 2 --per-page 30 -o vacancies.csv
```

**Ограничить количество детальных карточек на один запрос (предохранитель):**

```bash
python hh_parser.py -v --queries-file queries.txt --max-details 80 -o vacancies.csv
```

